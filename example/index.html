<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Leaflet Minard example</title>
        <meta name="description" content="An example of the use of Leaflet Minard library">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
              integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
              crossorigin=""/>
        <script type="text/javascript" src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
                integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
                crossorigin=""></script>
        <script type="text/javascript" src="../src/Leaflet.Pie.js"></script>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div id="example_map" style="width: 100vw; height: 100vh;"></div>

        <script type="text/javascript">
            const map = L.map('example_map').setView([48.21, 21.80], 5);

            L.tileLayer('http://tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var dataset = L.pieDataset({ scale_factor : 1}, [
                { 'name' : 'Agriculture', 'col' : '#791641'},
                { 'name' : 'Regional policy', 'col' : '#F2075D'},
                { 'name' : 'Research and development', 'col' : '#189A9F'},
                { 'name' : 'Citizenship, freedom, security and justice', 'col' : '#FFFADC'},
                { 'name' : 'Actions and programmes outside the EU', 'col' : '#FFFF00'},
                { 'name' : 'Administration', 'col' : '#012E40'},
            ]);

            var legend = L.Control.pieLegend({
                title       : 'Where does the EU money go in your country?',
                description : 'The figures used are the latest available, as published in the European Commissionâ€™s financial \
                                 report for 2015. The percentages used refer to money spent in all 28 EU countries. \
                                 Money that is spent outside the EU, e.g. in accession candidate countries and neighbouring countries, \
                                 is not taken into account in the calculations of the percentages displayed.',
                source_url  : 'http://www.europarl.europa.eu/external/html/budgetataglance/default_en.html',
                source_text : 'http://www.europarl.europa.eu/external/html/budgetataglance/default_en.html',
                dataset     : dataset,
            }).addTo(map);

             const ajax = new XMLHttpRequest();
            ajax.onreadystatechange = function() {
                if (ajax.readyState == XMLHttpRequest.DONE) {
                    if (ajax.status == 200) {
                        const countries_data = JSON.parse(ajax.response);
                        for(let name in countries_data){
                            const country = countries_data[name];
                            L.pieMarker(country.coords, dataset, name, country.data).addTo(map);
                        }
                    } else if(error_callback){
                        error_callback(ajax.response);
                    }
                }
            };
            ajax.open("GET", 'data.json', true);
            ajax.send();

        </script>
    </body>
</html>
